<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Konva Stage Test</title>
    <script src="https://unpkg.com/konva@9.3.20/konva.min.js"></script>
</head>
<body>
    <div id="container" style="border: 1px solid red; width: 800px; height: 600px;"></div>
    
    <script>
        console.log('Starting Konva Stage test...');
        
        // Monitor canvas creation
        const originalCreateElement = document.createElement;
        let canvasCreationCount = 0;
        
        document.createElement = function(tagName) {
            const element = originalCreateElement.call(document, tagName);
            if (tagName.toLowerCase() === 'canvas') {
                canvasCreationCount++;
                console.log(`ðŸš¨ CANVAS CREATED #${canvasCreationCount}!`);
                console.error('Canvas creation stack trace:', new Error().stack);
            }
            return element;
        };
        
        const container = document.getElementById('container');
        console.log('Container found:', container);
        console.log('Canvas count before Stage creation:', document.querySelectorAll('canvas').length);
        
        // Create Konva Stage
        const stage = new Konva.Stage({
            container: container,
            width: 800,
            height: 600,
            draggable: true
        });
        
        // Restore original createElement
        document.createElement = originalCreateElement;
        
        console.log('Stage created:', stage);
        console.log('Total canvas elements created during Stage init:', canvasCreationCount);
        console.log('Canvas count after Stage creation:', document.querySelectorAll('canvas').length);
        console.log('Canvas elements in container:', container.querySelectorAll('canvas').length);
        
        // Log stage properties
        console.log('Stage container:', stage.container());
        console.log('Stage content:', stage.content);
        console.log('Stage canvas:', stage.content?.querySelector('canvas'));
    </script>
</body>
</html>
