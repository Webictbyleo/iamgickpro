<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Canvas Issue</title>
    <script src="https://unpkg.com/konva@9.3.20/konva.min.js"></script>
    <style>
        body { margin: 20px; font-family: Arial, sans-serif; }
        #container { border: 2px solid red; width: 800px; height: 600px; background: #f0f0f0; margin: 20px 0; }
        .log { background: #f9f9f9; border: 1px solid #ddd; padding: 10px; margin: 10px 0; font-family: monospace; }
    </style>
</head>
<body>
    <h1>Canvas Debug Test</h1>
    <div id="container"></div>
    
    <button onclick="addTestElements()">Add Test Elements</button>
    <button onclick="logStageInfo()">Log Stage Info</button>
    <button onclick="forceRedraw()">Force Redraw</button>
    
    <div id="log" class="log"></div>
    
    <script>
        let stage, layer;
        let logDiv = document.getElementById('log');
        
        function log(message) {
            console.log(message);
            logDiv.innerHTML += message + '<br>';
        }
        
        // Initialize stage
        const container = document.getElementById('container');
        log('Creating Konva Stage...');
        
        stage = new Konva.Stage({
            container: container,
            width: 800,
            height: 600
        });
        
        log('Stage created: ' + !!stage);
        log('Stage width: ' + stage.width());
        log('Stage height: ' + stage.height());
        log('Stage container: ' + !!stage.container());
        log('Stage content: ' + !!stage.content);
        
        // Create main layer
        layer = new Konva.Layer();
        stage.add(layer);
        
        log('Layer created and added');
        log('Stage layers count: ' + stage.getChildren().length);
        
        function addTestElements() {
            log('Adding test elements...');
            
            // Clear existing elements
            layer.destroyChildren();
            
            // Add test rectangle
            const rect = new Konva.Rect({
                x: 50,
                y: 50,
                width: 100,
                height: 100,
                fill: 'red',
                stroke: 'black',
                strokeWidth: 2
            });
            layer.add(rect);
            log('Added red rectangle');
            
            // Add test circle
            const circle = new Konva.Circle({
                x: 200,
                y: 100,
                radius: 50,
                fill: 'blue',
                stroke: 'black',
                strokeWidth: 2
            });
            layer.add(circle);
            log('Added blue circle');
            
            // Add test text
            const text = new Konva.Text({
                x: 300,
                y: 80,
                text: 'Hello Konva!',
                fontSize: 24,
                fontFamily: 'Arial',
                fill: 'green'
            });
            layer.add(text);
            log('Added green text');
            
            // Force redraw
            layer.batchDraw();
            log('Layer redrawn');
            
            logStageInfo();
        }
        
        function logStageInfo() {
            log('=== STAGE INFO ===');
            log('Stage visible: ' + stage.visible());
            log('Stage canvas: ' + !!stage.content?.querySelector('canvas'));
            log('Stage layers: ' + stage.getChildren().length);
            log('Layer visible: ' + layer.visible());
            log('Layer children: ' + layer.getChildren().length);
            
            // Get canvas element
            const canvas = stage.content?.querySelector('canvas');
            if (canvas) {
                log('Canvas width: ' + canvas.width);
                log('Canvas height: ' + canvas.height);
                log('Canvas style.width: ' + canvas.style.width);
                log('Canvas style.height: ' + canvas.style.height);
                log('Canvas display: ' + canvas.style.display);
                log('Canvas visibility: ' + canvas.style.visibility);
                log('Canvas opacity: ' + canvas.style.opacity);
            } else {
                log('ERROR: No canvas found!');
            }
            
            // Check layer children
            layer.getChildren().forEach((child, index) => {
                log(`Child ${index}: ${child.getClassName()} - visible: ${child.visible()}`);
            });
        }
        
        function forceRedraw() {
            log('Force redrawing...');
            stage.batchDraw();
            layer.batchDraw();
            log('Redraw complete');
        }
        
        // Add initial test
        setTimeout(() => {
            addTestElements();
        }, 500);
    </script>
</body>
</html>
